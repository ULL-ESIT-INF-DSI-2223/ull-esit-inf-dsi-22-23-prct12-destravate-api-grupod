<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod</title><meta name="description" content="Documentation for ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/search.js" id="tsd-search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-content">
<div class="tsd-page-title">
<h2>ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod</h2></div>
<div class="tsd-panel tsd-typography"><p><a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod/actions/workflows/tests.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod/actions/workflows/tests.yml/badge.svg" alt="Tests"></a>
<a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod/badge.svg?branch=main" alt="Coverage Status"></a>
<a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupod&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:práctica-12-api-nodeexpress-de-registro-de-actividades-deportivas" class="tsd-anchor"></a><h1><a href="#md:práctica-12-api-nodeexpress-de-registro-de-actividades-deportivas">Práctica 12: API Node/Express de registro de actividades deportivas</a></h1><a id="md:descripción" class="tsd-anchor"></a><h2><a href="#md:descripción">Descripción</a></h2><p>Para esta práctica, tendremos que desarrollar una API REST que permita registrar actividades deportivas de los usuarios. Haremos uso de Node/Express para procesar operaciones CRUD sobre una base de datos MongoDB. Además, usaremos Mongoose para definir los modelos de datos y validarlos. Al final, desplegaremos el API en cyclic.</p>
<a id="md:requisitos" class="tsd-anchor"></a><h2><a href="#md:requisitos">Requisitos</a></h2><p>La API permitirá la creación, modificación, borrado y consulta de usuarios, rutas, retos y grupos. Las operaciones de modificación, borrado y consulta las podremos hacer en función del id del recurso o de su nombre.</p>
<a id="md:usuarios" class="tsd-anchor"></a><h3><a href="#md:usuarios">Usuarios</a></h3><p>Las operaciones que podremos realizar sobre los usuarios se realizarán en la ruta <code>/users</code>. Los usuarios tendrán los siguientes atributos:</p>
<ol>
<li>ID único del usuario (puede ser un username creado por el usuario en el registro o un valor generado automáticamente por el sistema).</li>
<li>Nombre del usuario.</li>
<li>Actividades que realiza: Correr o bicicleta.</li>
<li>Amigos en la aplicación: Colleción de IDs de usuarios con los que interacciona.</li>
<li>Grupos de amigos: Diferentes colecciones de IDs de usuarios con los que suele realizar rutas.</li>
<li>Estadísticas de entrenamiento: Cantidad de km y desnivel total acumulados en la semana, mes y año.</li>
<li>Rutas favoritas: IDs de las rutas que el usuario ha realizado con mayor frecuencia.</li>
<li>Retos activos: IDs de los retos que el usuario está realizando actualmente.</li>
<li>Histórico de rutas: Los usuarios deben almacenar el historial de rutas realizadas desde que se registraron en el sistema. La información almacenada en esta estructura de datos deberá contener la información de la fecha y el ID de la ruta realizada</li>
</ol>
<a id="md:rutas" class="tsd-anchor"></a><h3><a href="#md:rutas">Rutas</a></h3><p>Las operaciones que podremos realizar sobre las rutas se realizarán en la ruta <code>/tracks</code>. Las rutas tendrán los siguientes atributos:</p>
<ol>
<li>ID único de la ruta.</li>
<li>Nombre de la ruta.</li>
<li>Geolocalización del final de la ruta (coordenadas).</li>
<li>Geolocalización del inicio (coordenadas).</li>
<li>Longitud de la ruta en kilómetros.</li>
<li>Desnivel medio de la ruta.</li>
<li>Usuarios que han realizado la ruta (IDs).</li>
<li>Tipo de actividad: Indicador si la ruta se puede realizar en bicicleta o corriendo.</li>
<li>Calificación media de la ruta.</li>
</ol>
<a id="md:retos" class="tsd-anchor"></a><h3><a href="#md:retos">Retos</a></h3><p>Las operaciones que podremos realizar sobre los retos se realizarán en la ruta <code>/challenges</code>. Los retos tendrán los siguientes atributos:</p>
<ol>
<li>ID único del reto.</li>
<li>Nombre del reto.</li>
<li>Rutas que forman parte del reto.</li>
<li>Tipo de actividad del reto: bicicleta o correr.</li>
<li>Km totales a realizar (como la suma de los kms de las rutas que lo engloban).</li>
<li>Usuarios que están realizando el reto.</li>
</ol>
<a id="md:grupos" class="tsd-anchor"></a><h3><a href="#md:grupos">Grupos</a></h3><p>Las operaciones que podremos realizar sobre los grupos se realizarán en la ruta <code>/groups</code>. Los grupos tendrán los siguientes atributos:</p>
<ol>
<li>ID único del grupo.</li>
<li>Nombre del grupo.</li>
<li>Participantes: IDs de los miembros del grupo.</li>
<li>Estadísticas de entrenamiento grupal: Cantidad de km y desnivel total acumulados de manera grupal en la semana, mes y año</li>
<li>Clasificación de los usuarios: Ranking de los usuarios que más entrenamientos han realizado históricamente dentro del grupo, es decir, ordenar los usuarios por la cantidad de km totales o desnivel total que han acumulado.</li>
<li>Rutas favoritas del grupo: Rutas que los usuarios del grupo han realizado con mayor frecuencia en sus salidas conjuntas.</li>
<li>Histórico de rutas realizadas por el grupo: Información similar que almacenan los usuarios pero en este caso referente a los grupos.</li>
</ol>
<a id="md:modelos-y-esquemas" class="tsd-anchor"></a><h2><a href="#md:modelos-y-esquemas">Modelos y esquemas</a></h2><p>En primer lugar, tendremos que definir los esquemas y modelos para cada uno de los tipos de datos que podemos almacenar en nuestra base de datos. En el esquema, podremos definir el tipo de cada propiedad y si es requerida o no. Además, podremos definir valores por defecto para cada propiedad y crear validadores que ajusten los posibles valores que puedan tener.</p>
<a id="md:modelo-de-usuarios" class="tsd-anchor"></a><h3><a href="#md:modelo-de-usuarios">Modelo de usuarios</a></h3><pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">UsuarioInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">usuario_id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">usuario_nombre</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">actividad</span><span class="hl-1">: </span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">amigos</span><span class="hl-1">: </span><span class="hl-3">UsuarioInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">grupos</span><span class="hl-1">: </span><span class="hl-3">GrupoInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">km_semana</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">km_mes</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">km_ano</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_semana</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_mes</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_ano</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas</span><span class="hl-1">: </span><span class="hl-3">TrackInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">retos_activos</span><span class="hl-1">: </span><span class="hl-3">RetoInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas</span><span class="hl-1">: { </span><span class="hl-4">fehca</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">; </span><span class="hl-4">ruta</span><span class="hl-1">: </span><span class="hl-3">TrackInterface</span><span class="hl-1"> }[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">UsuarioSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">UsuarioInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">usuario_id:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;usuario_id must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">usuario_nombre:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;usuario_nombre must be at least 3 characters long&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">actividad:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">amigos:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">default:</span><span class="hl-1"> [], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">grupos:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">default:</span><span class="hl-1"> [], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Grupo&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">km_semana:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">km_mes:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">km_ano:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_semana:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_mes:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_ano:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">default:</span><span class="hl-1"> [], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">retos_activos:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">default:</span><span class="hl-1"> [], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Reto&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [{ </span><span class="hl-4">fecha:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">, </span><span class="hl-4">ruta:</span><span class="hl-1"> </span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1"> }],</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Usuario</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">UsuarioInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1">, </span><span class="hl-4">UsuarioSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>En primer lugar, definimos una interfaz que nos permitirá definir el tipo de los datos que se almacenarán en la base de datos. Luego, definimos el esquema que tendrá cada documento de la colección. Para cada propiedad, definimos el tipo de dato que almacenará, si es requerido o no, si tiene un valor por defecto, si tiene un valor único, o si tiene un validador que compruebe que el valor que se le pasa es correcto. En el caso de atributos que dependan de otros objetos, por ejemplo la lista de amigos, definimos el tipo como <code>Schema.Types.ObjectId</code> y le indicamos que se refiere a la colección <code>Usuario</code>. Lo mismo ocurre con los grupos, las rutas favoritas, los retos activos y el histórico de rutas. Finalmente, creamos el modelo a partir del esquema y lo exportamos.</p>
<a id="md:modelo-de-grupos" class="tsd-anchor"></a><h3><a href="#md:modelo-de-grupos">Modelo de grupos</a></h3><pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">GrupoInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">grupo_id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">grupo_nombre</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">participantes</span><span class="hl-1">: </span><span class="hl-3">UsuarioInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas_grupales</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">km_semana</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">km_mes</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">km_ano</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_semana</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_mes</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_ano</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas</span><span class="hl-1">: </span><span class="hl-3">TrackInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas</span><span class="hl-1">: { </span><span class="hl-4">fecha</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">; </span><span class="hl-4">ruta</span><span class="hl-1">: </span><span class="hl-3">TrackInterface</span><span class="hl-1"> }[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">GrupoSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">GrupoInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">grupo_id:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;grupo_id must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">grupo_nombre:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;grupo_nombre must be at least 3 characters long&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">participantes:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas_grupales:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">km_semana:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">km_mes:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">km_ano:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_semana:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_mes:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">desnivel_ano:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_semana must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [{ </span><span class="hl-4">fecha:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">, </span><span class="hl-4">ruta:</span><span class="hl-1"> </span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1"> }],</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Grupo</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">GrupoInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;Grupo&quot;</span><span class="hl-1">, </span><span class="hl-4">GrupoSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>De forma similar, definimos una interfaz que describa el tipo de datos que almacena un documento de grupo. Luego, definimos el esquema detallando los atributos de cada una de las propiedades y, al final, creamos el modelo y lo exportamos.</p>
<a id="md:modelo-de-retos" class="tsd-anchor"></a><h3><a href="#md:modelo-de-retos">Modelo de retos</a></h3><pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">RetoInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">reto_id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">reto_nombre</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">rutas</span><span class="hl-1">: </span><span class="hl-3">TrackInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">tipo</span><span class="hl-1">: </span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">km_totales</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios_realizando</span><span class="hl-1">: </span><span class="hl-3">UsuarioInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">RetoSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">RetoInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">reto_id:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;reto_id must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">reto_nombre:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;reto_nombre must be at least 3 characters long&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">], </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> [] },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">km_totales:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;km_totales must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios_realizando:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Reto</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">RetoInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;Reto&quot;</span><span class="hl-1">, </span><span class="hl-4">RetoSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>De igual manera, definimos el modelo de retos.</p>
<a id="md:modelo-de-rutas" class="tsd-anchor"></a><h3><a href="#md:modelo-de-rutas">Modelo de rutas</a></h3><pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">TrackInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">track_id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">track_nombre</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">localizacionInicio</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">localizacionFin</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">desnivel</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios_realizados</span><span class="hl-1">: </span><span class="hl-3">UsuarioInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">tipo</span><span class="hl-1">: </span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">calificacion</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">TrackSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">TrackInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">track_id:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;track_id must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">track_nombre:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;track_nombre must be at least 3 characters long&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">localizacionInicio:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">, </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">localizacionFin:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">, </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">desnivel:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&quot;desnivel must be a positive number&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios_realizados:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">calificacion:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">min:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-4">max:</span><span class="hl-1"> </span><span class="hl-8">5</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Track</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">TrackInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&quot;Track&quot;</span><span class="hl-1">, </span><span class="hl-4">TrackSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Finalmente, definimos el modelo de rutas.</p>
<a id="md:routers" class="tsd-anchor"></a><h2><a href="#md:routers">Routers</a></h2><p>Una vez definido cada uno de los modelos, tendremos que crear los routers que permitan realizar las operaciones CRUD sobre cada uno de ellos.</p>
<a id="md:router-de-usuarios" class="tsd-anchor"></a><h3><a href="#md:router-de-usuarios">Router de usuarios</a></h3><pre><code class="language-typescript"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">FilterType</span><span class="hl-1"> =</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">usuario_id</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">usuario_nombre</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariosRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">usuariosRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Usuario</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuariosRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">FilterType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarios</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">usuarios</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuarios</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;No users found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuariosRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: usuario_id, usuario_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&quot;usuario_nombre&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Update is not permitted&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">FilterType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">user</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;User not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuariosRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: usuario_id, usuario_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">FilterType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">usuario_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-9">// Eliminar usuario de la lista de amigos de otros usuarios</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">deleted_user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">users</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">amigos</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_user</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">amigos</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-9">// Eliminar usuario de la lista de usuarios de los grupos</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">grupo</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">participantes</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_user</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">participantes</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-9">// Eliminar usuario de la lista de usuarios de los retos</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">retos</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">reto</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">usuarios_realizando</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_user</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">usuarios_realizando</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-9">// Eliminar usuario de la lista de usuarios de las rutas</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">tracks</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">tracks</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">track</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">track</span><span class="hl-1">.</span><span class="hl-4">usuarios_realizados</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_user</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">track</span><span class="hl-1">.</span><span class="hl-4">usuarios_realizados</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">track</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">user</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;User not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Asignaremos las peticiones /POST a la creación de un usuario, /GET a la obtención de usuarios, /PATCH a la actualización de usuarios y /DELETE a la eliminación de usuarios.</p>
<ul>
<li>Para la creación de usuarios, se creará un nuevo usuario a partir de los datos recibidos en el cuerpo de la petición.</li>
<li>Para la obtención de usuarios, se comprobará si se ha recibido un parámetro de búsqueda, y en caso afirmativo, se buscará el usuario por el parámetro recibido. En caso negativo, se devolverán todos los usuarios.</li>
<li>Para la actualización de usuarios, se comprobará si se ha recibido un parámetro de búsqueda, y en caso afirmativo, se buscará el usuario por el parámetro recibido. En caso negativo, se devolverá un error. En caso de que se haya encontrado el usuario, se actualizarán los campos recibidos en el cuerpo de la petición.</li>
<li>Para la eliminación de usuarios, se comprobará si se ha recibido un parámetro de búsqueda, y en caso afirmativo, se buscará el usuario por el parámetro recibido. En caso negativo, se devolverá un error. En caso de que se haya encontrado el usuario, se eliminará de la base de datos, y se eliminará de la lista de amigos de los usuarios, de la lista de participantes de los grupos, de la lista de usuarios de los retos y de la lista de usuarios de las rutas.</li>
</ul>
<p>En cada una de las peticiones, se devolverá un código de estado HTTP 200 en caso de que la petición se haya realizado correctamente, y un código de estado HTTP 400 en caso de que la petición no se haya realizado correctamente. Por otra parte, se devolverá un código de estado HTTP 404 en caso de que no se haya encontrado el usuario, y un código de estado HTTP 500 en caso de que haya ocurrido un error en el servidor.</p>
<a id="md:rutas-de-grupos" class="tsd-anchor"></a><h3><a href="#md:rutas-de-grupos">Rutas de grupos</a></h3><pre><code class="language-typescript"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">NameIdType</span><span class="hl-1"> =</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">grupo_id</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">grupo_nombre</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-4">gruposRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&quot;/groups&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Grupo</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">gruposRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/groups&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupos</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;No groups found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">gruposRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&quot;/groups&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;You must provide at least one of the following: grupo_id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;grupo_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;participantes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;estadisticas_grupales&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;rutas_favoritas&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;historico_rutas&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Invalid update&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Group not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">gruposRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&quot;/groups&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: grupo_id, grupo_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">grupo_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">grupo_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-9">// Eliminar el grupo de los usuarios</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">deleted_group</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarios</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">usuarios</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">usuario</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_group</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Group not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El router de grupos tendrá las mismas peticiones que el router de usuarios, con la diferencia de que en la petición de eliminación de grupos, se eliminará el grupo de la lista de grupos de los usuarios.</p>
<a id="md:rutas-de-retos" class="tsd-anchor"></a><h3><a href="#md:rutas-de-retos">Rutas de retos</a></h3><pre><code class="language-typescript"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">NameIdType</span><span class="hl-1"> =</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">reto_id</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">reto_nombre</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-4">retosRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&quot;/challenges&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Reto</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retosRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/challenges&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">retos</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">retos</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;No retos found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retosRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&quot;/challenges&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;You must provide at least one of the following: reto_id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;reto_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;rutas&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;tipo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;km_totales&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;usuarios_realizando&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Invalid update&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Reto not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retosRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&quot;/challenges&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: reto_id, reto_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">reto_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">reto_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-9">//Eliminar reto de los usuarios que lo estén realizando</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">deleted_reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarios</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">usuarios</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">usuario</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index1</span><span class="hl-1"> = </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">retos_activos</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_reto</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index1</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">retos_activos</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index1</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Reto not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El router de retos tendrá las mismas peticiones que los otros routers, con la diferencia de que en la petición de eliminación de retos, se eliminará el reto de la lista de retos activos de los usuarios.</p>
<a id="md:rutas-de-rutas" class="tsd-anchor"></a><h3><a href="#md:rutas-de-rutas">Rutas de rutas</a></h3><pre><code class="language-typescript"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">NameIdType</span><span class="hl-1"> =</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">track_id</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  | {</span><br/><span class="hl-1">      </span><span class="hl-4">track_nombre</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-4">trackRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&quot;/tracks&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">track</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Track</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">track</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">track</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">trackRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/tracks&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">tracks</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-7">populate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;usuarios_realizados&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;usuario_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">tracks</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">tracks</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;No tracks found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">trackRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&quot;/tracks&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: track_id, track_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;track_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;localizacionInicio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;localizacionFin&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;usuarios_realizados&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;tipo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Invalid update&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">track</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">track</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">track</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">trackRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&quot;/tracks&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;You must provide at least one of the following: track_id or track_nombre&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filter</span><span class="hl-1">: </span><span class="hl-3">NameIdType</span><span class="hl-1"> = {};</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_id</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">filter</span><span class="hl-1"> = { </span><span class="hl-4">track_nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">track_nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() };</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-9">//Eliminar el track de las rutas favoritas de los usuarios</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">deleted_track</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarios</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">usuarios</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">usuario</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index1</span><span class="hl-1"> = </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">rutas_favoritas</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_track</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index1</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">rutas_favoritas</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index1</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index2</span><span class="hl-1"> = </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">historico_rutas</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_track</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index2</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">historico_rutas</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index2</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-9">//Eliminar el track de los retos</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">retos</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">reto</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">rutas</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_track</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">rutas</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-9">//Eliminar el track de los grupos</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">grupo</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index</span><span class="hl-1"> = </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">rutas_favoritas</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_track</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">rutas_favoritas</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">index2</span><span class="hl-1"> = </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">historico_rutas</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-4">deleted_track</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">index2</span><span class="hl-1"> &gt; -</span><span class="hl-8">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-4">historico_rutas</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-4">index2</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">track</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">track</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">track</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Track not found&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El router de rutas tendrá las mismas peticiones que los otros routers, con la diferencia de que en la petición de eliminación de rutas, se eliminará la ruta de las rutas favoritas e histórico de los usuarios, de los grupos y de los retos.</p>
<a id="md:conexion-con-la-base-de-datos" class="tsd-anchor"></a><h2><a href="#md:conexion-con-la-base-de-datos">Conexion con la base de datos</a></h2><p>Para la conexión con la base de datos se ha utilizado la librería mongoose.</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">connect</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;mongoose&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-6">MONGODB_URL</span><span class="hl-1">!);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&quot;Connected to MongoDB&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&quot;Error connecting to MongoDB&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>La dirección de la base de datos se encuentra en la variable de entorno MONGODB_URL. Esta variable se encuentra en el fichero .env, que se encuentra en el directorio <code>/config</code>.</p>
<a id="md:app" class="tsd-anchor"></a><h2><a href="#md:app">App</a></h2><p>Para la creación del servidor express, creamos un fichero app.ts en el directorio <code>/src</code> con el siguiente contenido:</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-7">express</span><span class="hl-1">();</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">usuariosRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">gruposRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">retosRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">trackRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">defaultRouter</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>En este fichero se importan los routers y se añaden al servidor express. También se añade el middleware express.json() para que el servidor pueda recibir peticiones con el formato JSON. En el fichero index.ts se importa el servidor y se escucha en el puerto definido por la variable de entorno PORT.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">port</span><span class="hl-1"> = </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-6">PORT</span><span class="hl-1">;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">listen</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">`Server running on port </span><span class="hl-2">${</span><span class="hl-4">port</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones</a></h2><p>En este proyecto hemos aprendido a utilizar las librerías express y mongoose para crear un servidor REST con Node.js. El uso de estas librerías nos ha permitido crear un servidor de forma rápida y sencilla, pudiendo definir las rutas y los controladores de forma independiente además de poder definir esquemas que definan la estructura de los datos que se van a almacenar en la base de datos.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://expressjs.com/">Express</a></li>
<li><a href="https://mongoosejs.com/">Mongoose</a></li>
<li><a href="https://www.mongodb.com/">MongoDB</a></li>
<li><a href="https://nodejs.org/en/">Node.js</a></li>
<li><a href="https://www.typescriptlang.org/">TypeScript</a></li>
</ul>
</div></div>
<div class="col-sidebar">
<div class="page-menu">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg>Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg>On This Page</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li>
<ul>
<li><a href="#md:práctica-12-api-nodeexpress-de-registro-de-actividades-deportivas"><span>Práctica 12: API <wbr/>Node/<wbr/>Express de registro de actividades deportivas</span></a></li>
<li>
<ul>
<li><a href="#md:descripción"><span>Descripción</span></a></li>
<li><a href="#md:requisitos"><span>Requisitos</span></a></li>
<li>
<ul>
<li><a href="#md:usuarios"><span>Usuarios</span></a></li>
<li><a href="#md:rutas"><span>Rutas</span></a></li>
<li><a href="#md:retos"><span>Retos</span></a></li>
<li><a href="#md:grupos"><span>Grupos</span></a></li></ul></li>
<li><a href="#md:modelos-y-esquemas"><span>Modelos y esquemas</span></a></li>
<li>
<ul>
<li><a href="#md:modelo-de-usuarios"><span>Modelo de usuarios</span></a></li>
<li><a href="#md:modelo-de-grupos"><span>Modelo de grupos</span></a></li>
<li><a href="#md:modelo-de-retos"><span>Modelo de retos</span></a></li>
<li><a href="#md:modelo-de-rutas"><span>Modelo de rutas</span></a></li></ul></li>
<li><a href="#md:routers"><span>Routers</span></a></li>
<li>
<ul>
<li><a href="#md:router-de-usuarios"><span>Router de usuarios</span></a></li>
<li><a href="#md:rutas-de-grupos"><span>Rutas de grupos</span></a></li>
<li><a href="#md:rutas-de-retos"><span>Rutas de retos</span></a></li>
<li><a href="#md:rutas-de-rutas"><span>Rutas de rutas</span></a></li></ul></li>
<li><a href="#md:conexion-con-la-base-de-datos"><span>Conexion con la base de datos</span></a></li>
<li><a href="#md:app"><span>App</span></a></li>
<li><a href="#md:conclusiones"><span>Conclusiones</span></a></li>
<li><a href="#md:bibliografía"><span>Bibliografía</span></a></li></ul></li></ul></li></ul></div></details></div>
<div class="site-menu">
<nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-namespace)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4-path"></rect><path d="M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z" fill="var(--color-text)" id="icon-4-text"></path></svg><span>ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>22-<wbr/>23-<wbr/>prct12-<wbr/>destravate-<wbr/>api-<wbr/>grupod</span></a>
<ul class="tsd-small-nested-navigation"></ul></nav></div></div></div>
<div class="tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div></body></html>